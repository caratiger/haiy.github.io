---
layout: post
---

{{page.title}}
===================
<p class="meta">July 17</p>


目前tensorflow是一个非常流行的深度学习计算框架，常规硬件及系统的安装方法官方的doc已经说的很清楚了，但是
因为系统是ubuntu16.04,显卡是GTX1080,所以不可避免的要折腾起来。在上一篇已经在16.04上安装好了驱动。接下来其实
重点安装的是CUDA和cuDNN.

首先说为什么要安装CUDA和cuDNN，关于采用GPU计算比CPU有速度有多少提升的benchmark找找就有，这次重点是怎么让tensorflow充分用的
上GTX1080能力。具体的就是如何把支持GTX1080的CUDA和cuDNN装起来，然后让tensorflow认识我们新装的CUDA和cuDNN。

首先总体说下安装步骤：
  - 1 首先要注册NVIDIA developer的帐号，分别下载CUDA和cuDNN
  - 2 确认准备gcc版本，安装依赖库sudo apt-get install freegl
  - 3 安装CUDA
  - 4 解压cuDNN
  - 5 clone tensorflow源码，configure配置
  - 6 编译安装

**准备工作**

在正式开始前，需要做几个准备工作，主要是大概先看下文档
 - [cuda FAQ](https://developer.nvidia.com/cuda-faq)   
 - [tensorflow 的安装文档](https://www.tensorflow.org/versions/r0.9/get_started/os_setup.html#installation-for-linux)  
 - [cuda-gpu的支持列表/计算能力/FAQ](https://developer.nvidia.com/cuda-gpus)   
 - [cudnn 5.1有多牛](https://developer.nvidia.com/cudnn)    
 - [cuda tookit下载页面](https://developer.nvidia.com/cuda-toolkit)   
 - [CUDA_Installation_Guide_Linux.pdf](http://developer.download.nvidia.com/compute/cuda/8.0/secure/rc1/docs/sidebar/CUDA_Installation_Guide_Linux.pdf?autho=1468747667_a33c2c5aad6add7797d818e74a4e359d&file=CUDA_Installation_Guide_Linux.pdf)   
 - [cudnn User Guide](http://developer.download.nvidia.com/compute/machine-learning/cudnn/secure/v5/prod/cudnn_library.pdf?autho=1468748018_294acb251230eed82708c40f593fb6ef&file=cudnn_library.pdf)

文档看过之后接下来就是实际动手的过程：

**1 注册NVIDIA developer的帐号，分别下载CUDA和cuDNN**

 - 1.1 下载CUDA
    打开[cuda toolkit下载页面](https://developer.nvidia.com/cuda-toolkit),GTX1080 要用的是CUDA 8。先点击[JOIN](https://developer.nvidia.com/cuda-registered-developer-program),注册帐号。
    完了后，再回到[cuda toolkit下载页面](https://developer.nvidia.com/cuda-toolkit)。选择
    linux, x86-64, ubuntu, 16.04, runfile(local) 
- 1.2 下载cuDNN
    进入[cudnn的下载页](https://developer.nvidia.com/cudnn),一堆调查,日志写时下载的是[Download cuDNN v5 (May 27, 2016), for CUDA 8.0 RC],点开选linux,不出意外的话这个就是[下载地址](http://developer.download.nvidia.com/compute/machine-learning/cudnn/secure/v5/prod/cudnn-8.0-linux-x64-v5.0-ga.tgz?autho=1468748153_fac10e6ed27d13c762cf9c62132fbd29&file=cudnn-8.0-linux-x64-v5.0-ga.tgz).

**2 确认GCC版本，安装依赖库**

确认本机gcc版本,16.04默认的是gcc 5,这里安装需要的最高是gcc 4.9。接下来就安装配置gcc 4.9.

- 2.1 安装gcc 4.9，并修改系统默认为4.9

```
sudo apt-get install gcc-4.9 gcc-4.9 g++-4.9 g++-4.9
gcc --version
sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 10
sudo update-alternatives --install /usr/bin/cc cc /usr/bin/gcc 30
sudo update-alternatives --set cc /usr/bin/gcc
sudo update-alternatives --install /usr/bin/c++ c++ /usr/bin/g++ 30
sudo update-alternatives --set c++ /usr/bin/g++
gcc --version
```
 - 2.2 一个小依赖
  ```sudo apt-get install freegl```

**3 安装CUDA**
  
  需要注意的是这个地方有个选择安装低版本驱动的地方，选n
  大致的安装流程如下：
  
  ```
  chmod  +x /cuda_8.0.27_linux.run
  ./cuda_8.0.27_linux.run
  
  ....
  
  Do you accept the previously read EULA?
  accept/decline/quit: accept
  
  Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 361.62?
  (y)es/(n)o/(q)uit: n
  
  Install the CUDA 8.0 Toolkit?
  (y)es/(n)o/(q)uit: y
  
  Enter Toolkit Location
   [ default is /usr/local/cuda-8.0 ]: 
  
  Do you want to install a symbolic link at /usr/local/cuda?
  (y)es/(n)o/(q)uit: y
  
  Install the CUDA 8.0 Samples?
  (y)es/(n)o/(q)uit: y
  
  Enter CUDA Samples Location
   [ default is /home/h ]: /home/h/Documents/cuda_samples
   
   ....
  ```





参考：
[CUDA和cuDNN的初步指导](http://www.52nlp.cn/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%BB%E6%9C%BA%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-ubuntu-16-04-nvidia-gtx-1080-cuda-8)  
[CUDA和cuDNN的初步指导 2](http://yangcha.github.io/GTX-1080/)

